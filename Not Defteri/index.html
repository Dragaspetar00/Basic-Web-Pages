<!DOCTYPE html>
<html lang="tr" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Not Defteri</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="https://dummyimage.com/192x192/ffffff/000000.png&text=ND"/>
  <meta name="theme-color" content="#6366f1"/>

  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --bg: #fafafa;
      --card-bg: #ffffff;
      --text: #1f2937;
      --border: #e5e7eb;
      --muted: #6b7280;
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --danger: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
    }
    [data-theme="dark"] {
      --bg: #0b1220;
      --card-bg: #121a2a;
      --text: #e5e7eb;
      --border: #1f2937;
      --muted: #9ca3af;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(99,102,241,0.08), transparent 60%), var(--bg);
      color: var(--text);
      padding: 16px;
      line-height: 1.55;
    }

    .container { max-width: 880px; margin: 0 auto; }

    header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 0 20px; margin-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    h1 {
      display: flex; align-items: center; gap: 12px;
      font-size: 1.35rem; font-weight: 800; letter-spacing: .2px;
    }
    h1 img { width: 40px; height: 40px; border-radius: 12px; box-shadow: var(--shadow); }
    #themeToggle {
      background: none; border: 1px solid var(--border); color: var(--text);
      padding: 8px 12px; border-radius: 12px; cursor: pointer; font-size: 1.1rem;
    }

    /* Cards */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
    }

    /* Editor section */
    .input-section { padding: 14px; margin-bottom: 18px; }
    .row { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
    .row .grow { flex: 1 1 220px; }

    input, select, button, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 15px;
    }
    input:focus, select:focus, textarea:focus { outline: 2px solid var(--primary); border-color: transparent; }
    textarea {
      min-height: 160px;
      resize: vertical;
      line-height: 1.6;
    }

    .editor-toolbar {
      display: flex; gap: 8px; flex-wrap: wrap;
    }
    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 6px; padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border);
      background: var(--bg); color: var(--text); cursor: pointer; font-weight: 600;
      transition: transform .04s ease-in-out, background .15s ease-in-out, border-color .15s ease-in-out;
      user-select: none;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary { background: var(--primary); border-color: var(--primary); color: white; }
    .btn-danger { background: var(--danger); border-color: var(--danger); color: white; }
    .btn-success { background: var(--success); border-color: var(--success); color: white; }
    .btn-warning { background: var(--warning); border-color: var(--warning); color: #1f2937; }
    .btn-ghost { background: transparent; }
    .btn-icon { width: 42px; padding: 10px; }
    .btn[disabled] { opacity: .6; cursor: not-allowed; }

    .switch {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 10px; border-radius: 10px; border: 1px dashed var(--border);
      color: var(--muted);
    }
    .switch input { width: auto; }

    .chips {
      display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px;
    }
    .chip {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 10px; border-radius: 9999px; background: var(--bg);
      border: 1px dashed var(--border); color: var(--muted); font-size: 12px;
    }

    .preview {
      border: 1px dashed var(--border);
      border-radius: 12px;
      padding: 12px;
      background: var(--bg);
      max-height: 420px;
      overflow: auto;
    }
    .preview h1, .preview h2, .preview h3 { margin: 10px 0 6px; }
    .preview p { margin-bottom: 8px; }
    .preview ul { margin: 8px 0 8px 18px; }
    .preview code {
      background: rgba(99,102,241,0.12);
      padding: 2px 6px; border-radius: 6px; border: 1px solid var(--border);
    }
    .preview pre {
      background: rgba(99,102,241,0.08);
      border: 1px solid var(--border);
      border-radius: 12px; padding: 10px; overflow: auto;
    }

    /* Tools / Filters */
    .tools { padding: 12px; margin-bottom: 18px; }
    .tools .row { margin-bottom: 8px; }
    .divider { height: 1px; background: var(--border); margin: 8px 0; border-radius: 1px; }

    /* List */
    ul { list-style: none; }
    .note-item {
      position: relative;
      padding: 14px; margin-bottom: 12px;
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    .note-header {
      display: flex; align-items: flex-start; justify-content: space-between; gap: 10px;
      margin-bottom: 10px;
    }
    .note-title {
      font-weight: 800; font-size: 1.05rem; line-height: 1.3; word-break: break-word;
    }
    .note-cat {
      background: var(--primary);
      color: white;
      padding: 4px 10px;
      border-radius: 9999px;
      font-size: 12px;
      font-weight: 700;
      white-space: nowrap;
    }
    .note-tags { display: flex; gap: 6px; flex-wrap: wrap; margin: 6px 0 8px; }
    .note-tag {
      font-size: 11px; color: var(--muted); background: var(--bg);
      border: 1px dashed var(--border); border-radius: 9999px; padding: 4px 8px;
    }
    .note-meta { font-size: 12px; color: var(--muted); margin: 8px 0; display: flex; gap: 12px; flex-wrap: wrap; }
    .note-content { margin: 6px 0 4px; }
    .note-audio, .note-image { margin-top: 8px; }
    .note-image { width: 100%; max-height: 320px; border-radius: 12px; object-fit: cover; }

    .note-actions {
      display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; justify-content: flex-end;
    }
    .btn-action { padding: 8px 10px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg); cursor: pointer; }
    .btn-action:active { transform: scale(0.98); }
    .btn-pin.active { color: #fbbf24; border-color: #fbbf24; }

    .completed .note-title, .completed .note-content { opacity: .75; text-decoration: line-through; }
    .pinned { box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.25), var(--shadow); }

    footer {
      text-align: center; padding: 14px 0; color: var(--muted); font-size: 0.95rem;
    }

    .hidden { display: none !important; }
    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;
    }

    /* Mobile tweaks */
    @media (max-width: 520px) {
      .btn-icon { width: 40px; }
      .row { flex-direction: column; }
      .editor-toolbar { gap: 6px; }
      .note-actions { justify-content: flex-start; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>
        <img src="https://dummyimage.com/300x300/ffffff/000000.png&text=Not+Defteri" alt="Logo"/>
        Not Defteri
      </h1>
      <button id="themeToggle" title="Tema Değiştir">🌙</button>
    </header>

    <!-- EDITÖR: Not oluşturma / düzenleme -->
    <section class="input-section card" id="editor">
      <!-- Başlık - Kategori -->
      <div class="row">
        <input class="grow" type="text" id="titleInput" placeholder="Başlık (ör. Toplantı notu)"/>
        <select id="categorySelect" title="Kategori">
          <option value="Genel">Genel</option>
          <option value="İş">İş</option>
          <option value="Kişisel">Kişisel</option>
          <option value="Okul">Okul</option>
          <option value="Alışveriş">Alışveriş</option>
          <option value="Sağlık">Sağlık</option>
        </select>
      </div>

      <!-- Etiketler - Pin -->
      <div class="row">
        <input class="grow" type="text" id="tagsInput" placeholder="Etiketler (virgülle ayır: iş, önemli, proje)"/>
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="pinToggle" class="btn btn-ghost" title="Öne Sabitle (Pin)">📌 Pin</button>
          <label class="switch" title="Önizleme">
            <input type="checkbox" id="previewToggle"/>
            Önizleme
          </label>
        </div>
      </div>

      <!-- Araç çubuğu -->
      <div class="row editor-toolbar">
        <div style="display:flex; gap:6px; flex-wrap:wrap;">
          <button class="btn btn-icon" id="mdH1" title="Başlık 1">H1</button>
          <button class="btn btn-icon" id="mdH2" title="Başlık 2">H2</button>
          <button class="btn btn-icon" id="mdBold" title="Kalın"><b>B</b></button>
          <button class="btn btn-icon" id="mdItalic" title="İtalik"><i>I</i></button>
          <button class="btn btn-icon" id="mdList" title="Liste">•</button>
          <button class="btn btn-icon" id="mdCode" title="Kod">{"</button>
          <button class="btn btn-icon" id="mdQuote" title="Alıntı">"</button>
          <button class="btn btn-icon" id="mdLink" title="Bağlantı">🔗</button>
        </div>
        <div style="display:flex; gap:8px; margin-left:auto; flex-wrap:wrap;">
          <input type="file" id="imageUpload" accept="image/*" class="hidden"/>
          <label for="imageUpload" class="btn" title="Resim Ekle">📷 Resim</label>

          <button id="recordBtn" class="btn" title="Ses Kaydı Başlat/Durdur">🎙️ Ses</button>
          <input type="file" id="audioUpload" accept="audio/*" class="btn hidden"/>
          <!-- Dilersen ses dosyası seçimi için buton kullanılabilir:
          <label for="audioUpload" class="btn">🎵 Ses Dosyası</label> -->
        </div>
      </div>

      <!-- Metin / Önizleme -->
      <div class="row">
        <textarea id="contentInput" placeholder="Not içeriğini yazın (Markdown destekli: **kalın**, *italik*, # Başlık, - liste)"></textarea>
        <div id="previewArea" class="preview hidden"></div>
      </div>

      <!-- Hatırlatma - Kaydet -->
      <div class="row">
        <input type="datetime-local" id="reminderTime" class="grow"/>
        <div style="display:flex; gap:8px;">
          <button id="saveBtn" class="btn btn-primary">Kaydet ✅</button>
          <button id="clearBtn" class="btn">Temizle</button>
        </div>
      </div>

      <!-- Seçilen medya bilgisi -->
      <div id="attachmentsInfo" class="chips hidden">
        <span class="chip" id="imgChip">🖼️ Resim eklendi</span>
        <span class="chip" id="audChip">🎧 Ses eklendi</span>
      </div>
    </section>

    <!-- ARAÇLAR: Arama / Filtreleme / Dışa-İçe Aktarma -->
    <section class="tools card">
      <div class="row">
        <input class="grow" type="text" id="searchInput" placeholder="Başlık veya içerikte ara..."/>
        <select id="filterCategory" title="Kategori Filtre">
          <option value="">Tüm Kategoriler</option>
          <option value="Genel">Genel</option>
          <option value="İş">İş</option>
          <option value="Kişisel">Kişisel</option>
          <option value="Okul">Okul</option>
          <option value="Alışveriş">Alışveriş</option>
          <option value="Sağlık">Sağlık</option>
        </select>
        <input type="text" id="filterTags" placeholder="Etiket filtre (virgülle)"/>
      </div>
      <div class="row">
        <input type="date" id="filterFrom" title="Tarih (başlangıç)"/>
        <input type="date" id="filterTo" title="Tarih (bitiş)"/>
        <select id="sortSelect" title="Sıralama" class="grow">
          <option value="pinned-desc-created-desc">Önce sabitlenenler, sonra yeni</option>
          <option value="created-desc">Tarihe göre: Yeni → Eski</option>
          <option value="created-asc">Tarihe göre: Eski → Yeni</option>
          <option value="title-asc">Başlığa göre: A → Z</option>
          <option value="title-desc">Başlığa göre: Z → A</option>
        </select>
        <button id="clearFiltersBtn" class="btn">Filtreleri Temizle</button>
      </div>

      <div class="divider"></div>

      <div class="row">
        <button id="exportJsonBtn" class="btn">💾 Dışa Aktar (JSON)</button>
        <button id="exportTxtBtn" class="btn">📄 Dışa Aktar (TXT)</button>
        <input type="file" id="importFile" accept=".json,.txt" class="hidden"/>
        <label for="importFile" class="btn btn-success">📥 İçe Aktar</label>
        <span id="stats" class="chip">0 not</span>
        <span id="offlineBadge" class="chip hidden">🛰️ Çevrimdışı</span>
      </div>
    </section>

    <!-- NOT LİSTESİ -->
    <ul id="taskList"></ul>

    <footer>
      <button id="shareBtn" class="btn">📲 Notları Paylaş</button>
      <p style="margin-top: 12px">Ana ekrana ekleyerek uygulama gibi kullan!</p>
    </footer>
  </div>

  <!-- JS (2/2 mesajında gelecek) -->
  <script>